<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Test API</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    input, button { margin: 5px 0; padding: 5px; }
    pre { background: #f4f4f4; padding: 10px; border: 1px solid #ccc; }
  </style>
</head>
<body>
  <h1>API Test</h1>

  <h2>Auth Endpoints</h2>
  <div>
    <h3>Register</h3>
    <input id="register-email" placeholder="Email">
    <input id="register-password" placeholder="Password" type="password">
    <button onclick="register()">Register</button>
  </div>

  <div>
    <h3>Login</h3>
    <input id="login-email" placeholder="Email">
    <input id="login-password" placeholder="Password" type="password">
    <button onclick="login()">Login</button>
  </div>

  <div>
    <h3>Me</h3>
    <button onclick="me()">Get Me</button>
  </div>

  <div>
    <h3>Refresh Token</h3>
    <button onclick="refresh()">Refresh</button>
  </div>

  <div>
    <h3>Logout</h3>
    <button onclick="logout()">Logout</button>
  </div>

  <h2>Books Endpoints</h2>
  <div>
    <h3>Get All Books</h3>
    <button onclick="getBooks()">Get Books</button>
  </div>

  <div>
    <h3>Get Book by ID</h3>
    <input id="book-id" placeholder="Book ID">
    <button onclick="getBookById()">Get Book</button>
  </div>

  <h2>Role Endpoint</h2>
  <div>
    <button onclick="getRole()">Get Role</button>
  </div>

  <h2>Response</h2>
  <pre id="output"></pre>

  <script>
    const BASE_URL = "https://project-api-5c-ikbar.vercel.app"; // Ganti jika lokal

    let token = ""; // simpan token setelah login

    function showResult(result) {
      document.getElementById("output").textContent = JSON.stringify(result, null, 2);
    }

    async function register() {
      const email = document.getElementById("register-email").value;
      const password = document.getElementById("register-password").value;
      const res = await fetch(`${BASE_URL}/api/auth/register`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email, password })
      });
      const data = await res.json();
      showResult(data);
    }

    async function login() {
      const email = document.getElementById("login-email").value;
      const password = document.getElementById("login-password").value;
      const res = await fetch(`${BASE_URL}/api/auth/login`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email, password })
      });
      const data = await res.json();
      if (data.token) token = data.token; // simpan token
      showResult(data);
    }

    async function me() {
      const res = await fetch(`${BASE_URL}/api/auth/me`, {
        headers: { "Authorization": `Bearer ${token}` }
      });
      const data = await res.json();
      showResult(data);
    }

    async function refresh() {
      const res = await fetch(`${BASE_URL}/api/auth/refresh`, {
        headers: { "Authorization": `Bearer ${token}` }
      });
      const data = await res.json();
      if (data.token) token = data.token;
      showResult(data);
    }

    async function logout() {
      const res = await fetch(`${BASE_URL}/api/auth/logout`, {
        method: "POST",
        headers: { "Authorization": `Bearer ${token}` }
      });
      const data = await res.json();
      token = ""; // clear token
      showResult(data);
    }

    async function getBooks() {
      const res = await fetch(`${BASE_URL}/api/books`);
      const data = await res.json();
      showResult(data);
    }

    async function getBookById() {
      const id = document.getElementById("book-id").value;
      const res = await fetch(`${BASE_URL}/api/books/${id}`);
      const data = await res.json();
      showResult(data);
    }

    async function getRole() {
      const res = await fetch(`${BASE_URL}/api/role`);
      const data = await res.json();
      showResult(data);
    }
  </script>
</body>
</html>
